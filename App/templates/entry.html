{% extends 'layout.html' %}
{% block content %}

<div class="container">
  <h4 class="center-align">ðŸ“¥ Submit Campus Data Entry</h4>

  <!-- Smart Dynamic Data Entry Form -->
  <form method="POST" action="{{ url_for('entry_views.entry') }}" id="entryForm" class="section">
    <div class="row">

      <!-- Year Selection -->
      <div class="input-field col s12 m6">
        <label for="year" class="active">Year</label>
        <select name="year" id="year" class="browser-default" required>
          <option value="" disabled selected>Choose a year</option>
          <option value="2022">2022</option>
          <option value="2023">2023</option>
          <option value="2024">2024</option>
        </select>
      </div>

      <!-- Campus Selection -->
      <div class="input-field col s12 m6">
        <label for="campus" class="active">Campus</label>
        <select name="campus" id="campus" class="browser-default" required>
          <option value="" disabled selected>Select campus</option>
          <option value="St Augustine">St Augustine</option>
          <option value="Mona">Mona</option>
          <option value="Cave Hill">Cave Hill</option>
        </select>
      </div>

      <!-- Question Type -->
      <div class="input-field col s12">
        <label for="question_type" class="active">Data Entry Type</label>
        <select name="question_type" id="question_type" class="browser-default" required onchange="showDynamicFields()">
          <option value="">--Select--</option>
          <option value="degree_percent">Percent of 20-year-olds in a degree program</option>
          <option value="avg_gpa_age">Average GPA by age group</option>
          <option value="housing_feedback">Student Housing Satisfaction</option>
        </select>
      </div>
    </div>

    <!-- Dynamic Fields -->
    <div class="row" id="dynamic-fields"></div>

    <button type="submit" name="submit_data" class="btn green">âœ… Add Entry</button>
  </form>

  <!-- Flash Messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div class="card-panel {{ 'green lighten-4' if category=='success' else 'blue lighten-4' }}">
          {{ msg }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- Current Entries -->
  <h5 class="mt-4">ðŸ§¾ Current Entries</h5>
  <ul class="collection">
    {% for item in data %}
      <li class="collection-item">
        <strong>{{ item.category }}</strong>: {{ item.label }} â€” {{ item.value }}<br>
        <small><em>{{ item.campus }}</em>, {{ item.year }}</small>
      </li>
    {% else %}
      <li class="collection-item grey-text">No entries yet</li>
    {% endfor %}
  </ul>

  <hr>

  <!-- Admin Review Button -->
  <form method="POST" action="{{ url_for('entry_views.submit_for_review') }}">
    <button type="submit" class="btn purple">ðŸ“¤ Upload for Admin Review</button>
  </form>
</div>

<!-- Dynamic Form Builder -->
<script>
function showDynamicFields() {
  const type = document.getElementById('question_type').value;
  const container = document.getElementById('dynamic-fields');
  container.innerHTML = '';

  if (type === 'degree_percent') {
    container.innerHTML = `
      <div class="input-field col s12 m4">
        <input type="number" name="age" required>
        <label class="active">Age Group</label>
      </div>
      <div class="input-field col s12 m4">
        <label class="active">Degree Program</label>
        <select name="degree" class="browser-default">
          <option value="Engineering">Engineering</option>
          <option value="Law">Law</option>
          <option value="Business">Business</option>
        </select>
      </div>
      <div class="input-field col s12 m4">
        <input type="number" name="percent" required>
        <label class="active">Percentage</label>
      </div>
    `;
  }

  if (type === 'avg_gpa_age') {
    container.innerHTML = `
      <div class="input-field col s12 m6">
        <input type="number" name="age" required>
        <label class="active">Age Group</label>
      </div>
      <div class="input-field col s12 m6">
        <input type="number" step="0.01" name="gpa" required>
        <label class="active">Average GPA</label>
      </div>
    `;
  }

  if (type === 'housing_feedback') {
    container.innerHTML = `
      <div class="input-field col s12 m4">
        <input type="number" name="housing_rating" min="1" max="5" required>
        <label class="active">Rating (1â€“5)</label>
      </div>
      <div class="input-field col s12 m8">
        <textarea name="housing_comment" class="materialize-textarea" rows="3" placeholder="Optional comment..."></textarea>
        <label class="active">Comment</label>
      </div>
    `;
  }
}
</script>

{% endblock %}
